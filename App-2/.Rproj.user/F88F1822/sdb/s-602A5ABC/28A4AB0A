{
    "contents" : "---\ntitle: \"Comparison of off-road glance duration focusing outliers\"\nauthor: \"Joonbum Lee and Jonathan Dobres\"\ndate: \"March 25, 2016\"\noutput: html_document\n---\n---\ntitle: \"Comaprison of off-road glance distribution focusing outliers\"\nauthor: \"Joonbum Lee\"\ndate: \"February 29, 2016\"\noutput: html_document\n---\n\n### Code to process and analyze glance data from five on-road studies.\n\n**Load library and custom functions**\n```{r Importing pacakges, include=FALSE}\nlibrary(plyr)\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(DBI)\nlibrary(RPostgreSQL)\nlibrary(gdata)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(lme4)\nlibrary(agelabr)\nlibrary(corrplot)\nlibrary(scales)\nlibrary(caret)\nlibrary(randomForest)\nlibrary(compute.es)\nlibrary(piecewiseSEM)\nlibrary(car)\nlibrary(coefplot)\nlibrary(scales)\n\n\nsource(\"~/Dropbox/Works/R codes/MIT/Functions/cor.mtest.R\")\nsource(\"~/Dropbox/Works/R codes/MIT/Functions/multiplot.R\")\n```\n\n**Pull glance data from six studies**\n```{r Loading data, include=FALSE}\n# data including only off-road glances\ng2013a<-read.csv(\"~/Documents/Local data archive/AgeLab2013a/2016 02 23 off-road glances and demo data and DBQ for 2013a including expert mode.csv\")\ng2013g<-read.csv(\"~/Documents/Local data archive/AgeLab2013g/2016 02 23 off-road glances and demo data and DBQ for 2013g.csv\")\ng2014b<-read.csv(\"~/Documents/Local data archive/AgeLab2014b/2016 02 23 off-road glances and demo data and DBQ for 2014b.csv\")\ng2014t<-read.csv(\"~/Documents/Local data archive/AgeLab2014t/2016 02 23 off-road glances and demo data and DBQ for 2014t.csv\")\ng2015b<-read.csv(\"~/Documents/Local data archive/AgeLab2015b/2016 02 23 off-road glances and demo data and DBQ for 2015b.csv\")\n\n# data including all glances\nglance.2013a<-read.csv(\"~/Documents/Local data archive/AgeLab2013a/2016 02 24 all glances and task time for 2013a.csv\")\nglance.2013g<-read.csv(\"~/Documents/Local data archive/AgeLab2013g/2016 02 24 all glances and task time for 2013g.csv\")\nglance.2014b<-read.csv(\"~/Documents/Local data archive/AgeLab2014b/2016 02 24 all glances and task time for 2014b.csv\")\nglance.2014t<-read.csv(\"~/Documents/Local data archive/AgeLab2014t/2016 02 24 all glances and task time for 2014t.csv\")\nglance.2015b<-read.csv(\"~/Documents/Local data archive/AgeLab2015b/2016 02 24 all glances and task time for 2015b.csv\")\n\n# combine all studies\nall.off <- rbind(g2013a,g2013g,g2014b,g2014t,g2015b) # 2015a was intentionally excluded.\n\n# remane levels of gender variable\nlevels(all.off$gender)[levels(all.off$gender)==\"M\"] <- \"Male\"\nlevels(all.off$gender)[levels(all.off$gender)==\"F\"] <- \"Female\"\n\n# add age group\nall.off$age_group[all.off$age >=18&all.off$age<=24]<-\"18-24\"\nall.off$age_group[all.off$age >=25&all.off$age<=39]<-\"25-39\"\nall.off$age_group[all.off$age >=40&all.off$age<=54]<-\"40-54\"\nall.off$age_group[all.off$age >=55]<-\"55-\"\n```\n\n**Descriptive statistics**\n```{r}\n# N\nlength(unique(all.off$new_subject)) # 288 + 32 (Experts from 2013a)\n# mean of off-road glance duration\nmean(all.off$duration) \n# SD duration\nsd(all.off$duration) \n# Max\nmax(all.off$duration)\n# Min\nmin(all.off$duration)\n# Mean + 2 SD\nmean(all.off$duration)+2*sd(all.off$duration)\ncutpoint <- mean(all.off$duration)+2*sd(all.off$duration)\n\n```\n\n**Labeling task type and modality**\n```{r Labeling, include=FALSE}\n# add task type (baseline vs. secondary task)\nall.off$task_type <-\"Driving with secondary tasks\"\nall.off$task_type[grepl(\"base\",all.off$task)] <- \"Just driving\"\n\n# exclude smartphone tasks from 2013g study\nall.off<-subset(all.off, !(task%in%c(\"m_p_1\",\"m_p_2\",\"m_p_3\",\"m_p_4\",\"m_p_base\", \"nav_p_1\",\"nav_p_2\",\"nav_p_3\",\"nav_p_entry_1\",\"nav_p_entry_2\",\"nav_p_entry_3\",\"nav_p_base\", \"nav_p_cancel_1\",\"nav_p_cancel_2\",\"nav_p_cancel_3\",\"nav_p_cancel1\",\"nav_p_cancel2\",\"nav_p_cancel3\",\"v_p_1\",\"v_p_2\",\"v_p_3\",\"v_p_4\",\"v_p_base\")))\n\n# add task modality (AV vs. VM)\nall.off$task_modality <-\"Auditory-vocal tasks\"\nall.off$task_modality[grepl(\"base\",all.off$task)] <- \"Just driving\"\nall.off$task_modality[all.off$task%in%c(\"radiom_1\",\"radiom_2\",\"radiom_4\",\"radiom_6\",\"radio_m1\",\"radio_m2\",\"radio_m4\",\"radio_m6\",\"m_c_1\",\"m_c_2\",\"m_c_3\",\"m_c_4\")] <-\"Visual-manual tasks\"\n\nall.off$task_type <- factor(all.off$task_type, levels = c(\"Just driving\", \"Driving with secondary tasks\"))\nall.off$task_modality <- factor(all.off$task_modality, levels = c(\"Just driving\", \"Auditory-vocal tasks\", \"Visual-manual tasks\"))\n```\n\n**Renaming task names**\n```{r Renaming, include=FALSE}\nall.off$task<-as.factor(all.off$task)\nlevels(all.off$task)[levels(all.off$task)==\"radio_m1\"] <- \"radiom_1\"\nlevels(all.off$task)[levels(all.off$task)==\"radio_m2\"] <- \"radiom_2\"\nlevels(all.off$task)[levels(all.off$task)==\"radio_m4\"] <- \"radiom_4\"\nlevels(all.off$task)[levels(all.off$task)==\"radio_m6\"] <- \"radiom_6\"\n\n# nav entry\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_1\"] <- \"nav_entry_1\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_2\"] <- \"nav_entry_2\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_3\"] <- \"nav_entry_3\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_entry_1\"] <- \"nav_entry_1\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_entry_2\"] <- \"nav_entry_2\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_entry_3\"] <- \"nav_entry_3\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_1\"] <- \"nav_entry_1\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_2\"] <- \"nav_entry_2\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_3\"] <- \"nav_entry_3\"\n\nlevels(all.off$task)[levels(all.off$task)==\"nav_cancel1\"] <- \"nav_cancel_1\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_cancel2\"] <- \"nav_cancel_2\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_cancel3\"] <- \"nav_cancel_3\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_cancel1\"] <- \"nav_cancel_1\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_cancel2\"] <- \"nav_cancel_2\"\nlevels(all.off$task)[levels(all.off$task)==\"nav_c_cancel3\"] <- \"nav_cancel_3\"\n\nlevels(all.off$task)[levels(all.off$task)==\"m_c_1\"] <- \"phonem_1\"\nlevels(all.off$task)[levels(all.off$task)==\"m_c_2\"] <- \"phonem_2\"\nlevels(all.off$task)[levels(all.off$task)==\"m_c_3\"] <- \"phonem_3\"\nlevels(all.off$task)[levels(all.off$task)==\"m_c_4\"] <- \"phonem_4\"\n\nlevels(all.off$task)[levels(all.off$task)==\"v_c_1\"] <- \"phone_1\"\nlevels(all.off$task)[levels(all.off$task)==\"v_c_2\"] <- \"phone_2\"\nlevels(all.off$task)[levels(all.off$task)==\"v_c_3\"] <- \"phone_3\"\nlevels(all.off$task)[levels(all.off$task)==\"v_c_4\"] <- \"phone_4\"\n```\n\n**Creating tasktime table**\n```{r Renaming II, include=FALSE}\ntasktime.table <- rbind(glance.2013a, glance.2013g, glance.2014b, glance.2014t, glance.2015b)%>%ddply(.(new_subject, task), summarise, task_time=max(task_time))\ntasktime.table$task<-as.factor(tasktime.table$task)\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"radio_m1\"] <- \"radiom_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"radio_m2\"] <- \"radiom_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"radio_m4\"] <- \"radiom_4\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"radio_m6\"] <- \"radiom_6\"\n\n# nav entry\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_1\"] <- \"nav_entry_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_2\"] <- \"nav_entry_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_3\"] <- \"nav_entry_3\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_entry_1\"] <- \"nav_entry_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_entry_2\"] <- \"nav_entry_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_entry_3\"] <- \"nav_entry_3\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_1\"] <- \"nav_entry_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_2\"] <- \"nav_entry_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_3\"] <- \"nav_entry_3\"\n\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_cancel1\"] <- \"nav_cancel_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_cancel2\"] <- \"nav_cancel_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_cancel3\"] <- \"nav_cancel_3\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_cancel1\"] <- \"nav_cancel_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_cancel2\"] <- \"nav_cancel_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"nav_c_cancel3\"] <- \"nav_cancel_3\"\n\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"m_c_1\"] <- \"phonem_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"m_c_2\"] <- \"phonem_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"m_c_3\"] <- \"phonem_3\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"m_c_4\"] <- \"phonem_4\"\n\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"v_c_1\"] <- \"phone_1\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"v_c_2\"] <- \"phone_2\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"v_c_3\"] <- \"phone_3\"\nlevels(tasktime.table$task)[levels(tasktime.table$task)==\"v_c_4\"] <- \"phone_4\"\n```\n\n\n**Plotting glance distributions**\n```{r Plotting, fig.height=6, fig.width=12, echo=FALSE}\n# plot histogram of off-road glances (N=320)\nggplot(all.off, aes(x=duration))+geom_histogram(binwidth=0.1,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"Single off-road glance duration (sec)\")+geom_vline(aes(xintercept=mean(duration)), colour=\"navyblue\", linetype=4)+geom_vline(aes(xintercept=mean(duration)+2*sd(duration)), colour=\"skyblue3\", linetype=2)+geom_vline(xintercept=2, colour=\"tomato1\", linetype=3)+annotate(\"text\", x=mean(all.off$duration)+0.3, y=700, label=\"Mean\")+annotate(\"text\", x=mean(all.off$duration)+2*sd(all.off$duration)+0.6, y=19000, label=\"Mean + 2 SD\", colour=\"skyblue3\")+annotate(\"text\", x=2.5, y=700, label=\"2 seconds\", colour=\"tomato1\") # size = 12 * 6\n\n\nall.off$tail[all.off$duration >=cutpoint]<-\"Outliers\"\nall.off$tail[all.off$duration <cutpoint]<-\"Non-outliers\"\n\nggplot(all.off, aes(x=gender))+geom_bar(width=0.5,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"\")+facet_wrap(~tail, scales=\"free\")\nggplot(all.off, aes(x=age_group))+geom_bar(width=0.5,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"\")+facet_wrap(~tail, scales=\"free\")\nggplot(all.off, aes(x=task_modality))+geom_bar(width=0.5,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"\")+facet_wrap(~tail, scales=\"free\")\n\nall.off.long <- subset(all.off, duration >= cutpoint)\n\nall.off.short <- subset(all.off, duration < cutpoint)\nall.off.long <- subset(all.off, duration >= cutpoint)\n\nggplot(all.off.long, aes(x=task_modality))+geom_bar()\nggplot(all.off.short, aes(x=task_modality))+geom_bar()\n\nggplot(all.off.long, aes(x=age_group))+geom_bar()\nggplot(all.off.short, aes(x=age_group))+geom_bar()\n\nggplot(all.off.long, aes(x=gender))+geom_bar()\nggplot(all.off.short, aes(x=gender))+geom_bar()\n\n# by task modality\nggplot(all.off, aes(x=duration,group=task_modality))+geom_histogram(binwidth=0.1,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"Single off-road glance duration (sec)\")+facet_grid(task_modality~., scale=\"free\")+geom_vline(data=aggregate(duration~task_modality, all.off, function(x) c(mean=mean(x), sd=sd(x))), mapping=aes(xintercept=duration[,1]+2*duration[,2]), linetype=2) +geom_vline(xintercept = cutpoint, colour=\"navyblue\", linetype=3) # size = 12 * 9\n\n# by age group\nggplot(all.off, aes(x=duration,group=age_group))+geom_histogram(binwidth=0.1,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"Single off-road glance duration (sec)\")+facet_grid(age_group~., scale=\"free\")+geom_vline(data=aggregate(duration~age_group, all.off, function(x) c(mean=mean(x), sd=sd(x))), mapping=aes(xintercept=duration[,1]+2*duration[,2]), linetype=2) +geom_vline(xintercept = cutpoint, colour=\"navyblue\", linetype=3)# size = 12 * 9\n\n# by gender\nggplot(all.off, aes(x=duration,group=gender))+geom_histogram(binwidth=0.1,fill=\"darkgrey\")+theme_grey(16)+ylab(\"Frequency\")+xlab(\"Single off-road glance duration (sec)\")+facet_grid(gender~., scale=\"free\")+geom_vline(data=aggregate(duration~gender, all.off, function(x) c(mean=mean(x), sd=sd(x))), mapping=aes(xintercept=duration[,1]+2*duration[,2]), linetype=2) +geom_vline(xintercept = cutpoint, colour=\"navyblue\", linetype=3)# size = 12 * 9\n\n# cumulative probability by task modality\nggplot(all.off, aes(x=duration, group=task_modality))+stat_ecdf(aes(colour=task_modality, linetype=task_modality),size=0.7)+theme_bw(16)+ylab(\"Cumulative probability\")+xlab(\"Off-road glance duration (sec)\")+theme(legend.position=\"top\")\n\n# cumulative probability by age group\nggplot(all.off, aes(x=duration, group=age_group))+stat_ecdf(aes(colour=age_group, linetype=age_group),size=0.7)+theme_bw(16)+ylab(\"Cumulative probability\")+xlab(\"Off-road glance duration (sec)\")+theme(legend.position=\"top\")\n\n# cumulative probability by gender\nggplot(all.off, aes(x=duration, group=gender))+stat_ecdf(aes(colour=gender, linetype=gender),size=0.7)+theme_bw(16)+ylab(\"Cumulative probability\")+xlab(\"Off-road glance duration (sec)\")+theme(legend.position=\"top\")\n\n```\n\n**Linear model for off-road glance duration**\n```{r Regression, fig.height=6, fig.width=12, echo=FALSE}\n# linear model\noff.sum <- ddply(all.off, .(new_subject, car, gender, age_group, task_modality), summarise,\n                      mean_duration = mean(duration),\n                      sd_duration = sd(duration))\n\nfullmodel <- lmer(mean_duration~gender+age_group+task_modality+(1|new_subject), data=off.sum)\nsimplemodel <- lmer(mean_duration~task_modality+(1|new_subject), data=off.sum)\n\nsummary(fullmodel)\nAnova(fullmodel, test.statistic = \"F\")\nsem.model.fits(fullmodel)\ncoefplot(fullmodel)+theme_bw(16)\n\n# mean comparison\nggplot(off.sum, aes(x=task_modality,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task modality\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)\nggplot(off.sum, aes(x=task_modality,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)+facet_grid(car~.)\nggplot(off.sum, aes(x=age_group,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task modality\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)\nggplot(off.sum, aes(x=gender,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task modality\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)\n\nsummary(simplemodel)\nAnova(simplemodel, test.statistic = \"F\")\nsem.model.fits(simplemodel)\n\n#KS test\njd <- subset(off.sum, task_modality==\"Just driving\")\nav <- subset(off.sum, task_modality==\"Auditory-vocal tasks\")\nvm <- subset(off.sum, task_modality==\"Visual-manual tasks\")\n\nks.test(jd$mean_duration,av$mean_duration)\nks.test(jd$mean_duration,vm$mean_duration)\nks.test(av$mean_duration,vm$mean_duration)\n\nt.test(jd$mean_duration,av$mean_duration)\nt.test(jd$mean_duration,vm$mean_duration)\nt.test(av$mean_duration,vm$mean_duration)\n\n# additional analysis focusing on individual study\n# 2013g only phone\ndata2013g.phone <- subset(all.off, car%in%c(\"Equinox\",\"XC60\")) %>% subset(task%in%c(\"phonem_1\",\"phonem_2\",\"phonem_3\",\"phonem_4\",\"m_c_base\",\"phone_1\",\"phone_2\",\"phone_3\",\"phone_4\",\"v_c_base\"))\noff.sum.2013g <- ddply(data2013g.phone, .(new_subject, gender, age_group, task_modality), summarise,\n                      mean_duration = mean(duration),\n                      sd_duration = sd(duration))\nggplot(off.sum.2013g, aes(x=task_modality,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)+ggtitle(\"Data including only 2013g AV/VM phone tasks\")+theme(plot.title=element_text(size=16))\n\n# 2013a only radio\ndata2013a.radio <- subset(all.off, car==\"MKS\")%>%subset(task%in%c(\"radiom_1\",\"radiom_2\",\"radiom_4\",\"radiom_6\",\"radiov_1\",\"radiov_2\",\"radiov_4\",\"radiov_6\",\"radiom_base\",\"radiov_base\"))\noff.sum.2013a <- ddply(data2013a.radio, .(new_subject, gender, age_group, task_modality), summarise,\n                      mean_duration = mean(duration),\n                      sd_duration = sd(duration))\nggplot(off.sum.2013a, aes(x=task_modality,y=mean_duration))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_bw(16)+ggtitle(\"Data including only 2013a AV/VM radio tasks\")+theme(plot.title=element_text(size=16))\n```\n\n#\nbase.sum <-subset(off.sum, task_modality==\"Just driving\")\nav.sum <-subset(off.sum, task_modality==\"Auditory-vocal tasks\")\nvm.sum <-subset(off.sum, task_modality==\"Visual-manual tasks\")\n\nggplot(base.sum, aes(x=mean_duration))+geom_histogram(binwidth=0.02)+geom_vline(aes(xintercept=mean(mean_duration)+2*sd(mean_duration)), linetype=2)\nggplot(av.sum, aes(x=mean_duration))+geom_histogram(binwidth=0.02)+geom_vline(aes(xintercept=mean(mean_duration)+2*sd(mean_duration)), linetype=2)\nggplot(vm.sum, aes(x=mean_duration))+geom_histogram(binwidth=0.02)+geom_vline(aes(xintercept=mean(mean_duration)+2*sd(mean_duration)), linetype=2)\n\nggplot(base.sum, aes(y=mean_duration,x=new_subject))+geom_point(alpha=I(.4))\nggplot(av.sum, aes(y=mean_duration,x=new_subject))+geom_point(alpha=I(.4))\n\n#\n\n\n**Investigation of long off-road glances: part 1**\n```{r Long off-road glances, fig.width=12, fig.height=6}\n# filter long off-road glances (> mean + 2SD)\ncutpoint<-mean(all.off$duration) + 2*sd(all.off$duration)\nlong.off <- subset(all.off, duration > cutpoint) \nlong.off.2013g <- subset(data2013g.phone, duration >cutpoint)\nlong.off.2013a <- subset(data2013a.radio, duration >cutpoint)\n\n# histogram\nggplot(long.off, aes(x=look))+geom_bar(width=0.5, fill=\"navyblue\")+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Glance locations\")\n# by glance locations x car\nggplot(long.off, aes(x=look))+geom_bar(width=0.5, fill=\"navyblue\")+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Glance locations\")+facet_grid(.~car)+theme(axis.text.x = element_text(angle = 45, hjust = 1))\nggplot(long.off, aes(x=look))+geom_bar(width=0.5, fill=\"navyblue\")+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Glance locations\")+facet_wrap(~car)+theme(axis.text.x = element_text(angle = 45, hjust = 1))\n# by glance locations x car (percentage)\nggplot(long.off, aes(x=look, group=car))+geom_bar(width=0.5,fill=\"navyblue\")+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Glance locations\")+theme(axis.text.x = element_text(angle = 45, hjust = 1))+facet_grid(.~car)\nggplot(long.off, aes(x=look, group=car))+geom_bar(width=0.5,fill=\"navyblue\")+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Glance locations\")+theme(axis.text.x = element_text(angle = 45, hjust = 1))+facet_wrap(~car)\n\n# ggplot(long.off, aes(x=look, group=car))+geom_histogram(aes(y=..density..),binwidth=0.1,fill=\"navyblue\")+theme_bw(16)+ylab(\"Density\")+xlab(\"Glance locations\")+theme(axis.text.x = element_text(angle = 45, hjust = 1))+facet_grid(.~car)+scale_y_continuous(labels = percent_format())\n# ggplot(long.off, aes(x=look, group=car))+geom_histogram(aes(y=..density..),binwidth=0.1,fill=\"navyblue\")+theme_bw(16)+ylab(\"Density\")+xlab(\"Glance locations\")+theme(axis.text.x = element_text(angle = 45, hjust = 1))+facet_wrap(~car)+scale_y_continuous(labels = percent_format())\n\n# summary data for regression models\nlong.off.sum <- ddply(long.off, .(new_subject, car, gender, age_group, task_modality), summarise,\n                      num_long_glance = length(look))\nlong.off.sum.2013g <- ddply(long.off.2013g, .(new_subject, gender, age_group, task_modality), summarise,\n                      num_long_glance = length(look))\nlong.off.sum.2013a <- ddply(long.off.2013a, .(new_subject, gender, age_group, task_modality), summarise,\n                      num_long_glance = length(look))\n# long.off.sum.2014b <- ddply(long.off.2014b, .(new_subject, gender, age_group, task_modality), summarise,\n#                       num_long_glance = length(look))\n\n# histograms\nggplot(long.off.sum, aes(x=num_long_glance))+geom_histogram(binwidth=1)+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Number of long off-road glances per subject\")\nggplot(long.off.sum, aes(x=num_long_glance))+geom_histogram(binwidth=1)+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Number of long off-road glances per subject\")+facet_grid(gender~.)\nggplot(long.off.sum, aes(x=num_long_glance))+geom_histogram(aes(fill=age_group),binwidth=1)+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Number of long off-road glances per subject\")+facet_grid(age_group~.)+theme(legend.position=\"none\")\nggplot(long.off.sum, aes(x=num_long_glance))+geom_histogram(aes(fill=age_group),binwidth=1)+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Number of long off-road glances per subject\")+facet_grid(age_group~gender)+theme(legend.position=\"none\")\nggplot(long.off.sum, aes(x=num_long_glance))+geom_histogram(aes(fill=task_modality),binwidth=1)+theme_bw(16)+ylab(\"Frequency\")+xlab(\"Number of long off-road glances per subject\")+facet_grid(task_modality~.)+theme(legend.position=\"none\")\n\n# fullmodel <- lm(num_long_glance~gender+age_group, data=long.off.sum)\n# summary(fullmodel)\n# anova(fullmodel)\n# Anova(fullmodel, test.statistic = \"F\")\n# sem.model.fits(fullmodel)\n\n# linear model\nfullmodel <- lmer(num_long_glance~gender+age_group+task_modality+(1|new_subject), data=long.off.sum)\nsummary(fullmodel)\nAnova(fullmodel, test.statistic = \"F\")\nsem.model.fits(fullmodel)\ncoefplot(fullmodel)+theme_bw(16)\nggplot(long.off.sum, aes(x=task_modality,y=num_long_glance))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glance per subject\")+theme_bw(16)\nggplot(long.off.sum.2013g, aes(x=task_modality,y=num_long_glance))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glance per subject\")+theme_bw(16)+ggtitle(\"Data including only 2013g AV/VM phone tasks\")+theme(plot.title=element_text(size=16))\nggplot(long.off.sum.2013a, aes(x=task_modality,y=num_long_glance))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glance per subject\")+theme_bw(16)+ggtitle(\"Data including only 2013a AV/VM radio tasks\")+theme(plot.title=element_text(size=16))\n# ggplot(long.off.sum.2014b, aes(x=task_modality,y=num_long_glance))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glance per subject\")+theme_bw(16)+ggtitle(\"Data including only 2014b all tasks\")+theme(plot.title=element_text(size=16))\n\nggplot(long.off.sum, aes(x=task_modality,y=num_long_glance))+stat_summary(fun.data =\"mean_cl_boot\", colour=\"red\", size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glance per subject\")+theme_bw(16)+facet_grid(car~.)\n```\n\n**Investigation of long off-road glances: part 2**\n```{r Long off-road glances II, fig.height=9, fig.width=12}\n# number of long off-road glances\nlong.off.sum.task <- ddply(long.off, .(new_subject, car, gender, age_group, task_modality,task), summarise,\n                      num_long_glance = length(look))\nlong.off.sum.task.ordered <- transform(long.off.sum.task,\n                          task = reorder(task, num_long_glance))\n\nggplot(long.off.sum.task.ordered, aes(x=task,y=num_long_glance))+stat_summary(aes(colour=task_modality),fun.data =\"mean_cl_boot\",size=1)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glances\")+theme_bw(16)+coord_flip()+scale_colour_manual(values=c(\"grey\",\"tomato1\",\"skyblue3\"))\nggplot(long.off.sum.task.ordered, aes(x=task,y=num_long_glance))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glances\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))\n\nsub.long.off<-long.off\nsub.long.off$task_group[sub.long.off$task == \"radiom_1\"]<-\"radio manual easy\"\nsub.long.off$task_group[sub.long.off$task == \"radiom_2\"]<-\"radio manual easy\"\nsub.long.off$task_group[sub.long.off$task == \"radiom_4\"]<-\"radio manual hard\"\nsub.long.off$task_group[sub.long.off$task == \"radiom_6\"]<-\"radio manual hard\"\nsub.long.off$task_group[grepl(\"base\",sub.long.off$task)] <- \"baseline driving\"\nsub.long.off$task_group[grepl(\"poi_cancel\",sub.long.off$task)] <- \"POI cancel\"\nsub.long.off$task_group[grepl(\"nav_cancel\",sub.long.off$task)] <- \"nav cancel\"\nsub.long.off$task_group[sub.long.off$task == \"radiov_1\"]<-\"radio voice easy\"\nsub.long.off$task_group[sub.long.off$task == \"radiov_2\"]<-\"radio voice easy\"\nsub.long.off$task_group[sub.long.off$task == \"radiov_4\"]<-\"radio voice hard\"\nsub.long.off$task_group[sub.long.off$task == \"radiov_6\"]<-\"radio voice hard\"\nsub.long.off$task_group[sub.long.off$task == \"nav_entry_1\"]<-\"nav entry\"\nsub.long.off$task_group[sub.long.off$task == \"nav_entry_2\"]<-\"nav entry\"\nsub.long.off$task_group[sub.long.off$task == \"nav_entry_3\"]<-\"nav entry\"\nsub.long.off$task_group[sub.long.off$task == \"nav_entry_4\"]<-\"nav entry\"\nsub.long.off$task_group[sub.long.off$task == \"nav_4\"]<-\"nav entry\"\nsub.long.off$task_group[sub.long.off$task == \"poi_1\"]<-\"POI\"\nsub.long.off$task_group[sub.long.off$task == \"poi_2\"]<-\"POI\"\nsub.long.off$task_group[sub.long.off$task == \"poi_3\"]<-\"POI\"\nsub.long.off$task_group[sub.long.off$task == \"poi_4\"]<-\"POI\"\nsub.long.off$task_group[sub.long.off$task == \"phone_1\"]<-\"phone voice\"\nsub.long.off$task_group[sub.long.off$task == \"phone_2\"]<-\"phone voice\"\nsub.long.off$task_group[sub.long.off$task == \"phone_3\"]<-\"phone voice\"\nsub.long.off$task_group[sub.long.off$task == \"phone_4\"]<-\"phone voice\"\nsub.long.off$task_group[sub.long.off$task == \"phonem_1\"]<-\"phone manual\"\nsub.long.off$task_group[sub.long.off$task == \"phonem_2\"]<-\"phone manual\"\nsub.long.off$task_group[sub.long.off$task == \"phonem_3\"]<-\"phone manual\"\nsub.long.off$task_group[sub.long.off$task == \"phonem_4\"]<-\"phone manual\"\n\nunique(sub.long.off$task_group)\n\nsub.long.off.sum.task <- ddply(sub.long.off, .(new_subject, car, gender, age_group, task_modality,task,task_group), summarise,\n                      num_long_glance = length(look))\nsub.long.off.sum.task.ordered <- transform(sub.long.off.sum.task,\n                          task_group = reorder(task_group, num_long_glance))\nggplot(sub.long.off.sum.task.ordered, aes(x=task_group,y=num_long_glance))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=5)+xlab(\"Task group\")+ylab(\"Mean number of long off-road glances\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))\n\nsub.long.off.sum.task.time <- join(sub.long.off.sum.task, tasktime.table, by=c(\"new_subject\",\"task\"))\nsub.long.off.sum.task.time$num_long_glance_minute <- 60*sub.long.off.sum.task.time$num_long_glance/sub.long.off.sum.task.time$task_time\nsub.long.off.sum.task.time.ordered <- transform(sub.long.off.sum.task.time,\n                          task_group = reorder(task_group, num_long_glance_minute))\nggplot(sub.long.off.sum.task.time.ordered, aes(x=task_group,y=num_long_glance_minute))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=5)+xlab(\"Task group\")+ylab(\"Mean number of long off-road glances (per minute)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))\nggplot(sub.long.off.sum.task.time.ordered, aes(x=task_group,y=num_long_glance_minute))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=5)+xlab(\"Task group\")+ylab(\"Mean number of long off-road glances (per minute)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))+facet_grid(.~car)\n\n\n# normalized number of long off-road glances\nlong.off.sum.task.time <- join(long.off.sum.task, tasktime.table, by=c(\"new_subject\",\"task\"))\nlong.off.sum.task.time$num_long_glance_minute <- 60*long.off.sum.task.time$num_long_glance/long.off.sum.task.time$task_time\nlong.off.sum.task.time.ordered <- transform(long.off.sum.task.time,\n                          task = reorder(task, num_long_glance_minute))\n\nggplot(long.off.sum.task.time.ordered, aes(x=task,y=num_long_glance_minute))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glances (per minute)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))\nggplot(long.off.sum.task.time.ordered, aes(x=task,y=num_long_glance_minute))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Task type\")+ylab(\"Mean number of long off-road glances (per minute)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))+facet_grid(.~car)\n\n# mean off-road glance duration\noff.sum.task <- ddply(all.off, .(new_subject, car, gender, age_group, task_modality,task), summarise,\n                      mean_duration = mean(duration),\n                      sd_duration = sd(duration))\n\n# add age x gender variable\noff.sum.task$gender_age <- paste(off.sum.task$gender, \"from\", off.sum.task$age_group)\n\noff.sum.task.ordered <- transform(off.sum.task,\n                          task = reorder(task, mean_duration))\n\noff.sum.task.ordered2 <- transform(off.sum.task,\n                          gender_age = reorder(gender_age, mean_duration))\n\nggplot(off.sum.task.ordered, aes(x=task,y=mean_duration))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Task type\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))\nggplot(off.sum.task.ordered, aes(x=task,y=mean_duration))+stat_summary(aes(colour=task_modality),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Task type\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\"))+facet_grid(.~car)\n\nggplot(off.sum.task.ordered2, aes(x=gender_age,y=mean_duration))+stat_summary(aes(colour=age_group),fun.y =\"mean\",geom=\"point\",size=3)+xlab(\"Gender and age group\")+ylab(\"Mean of single off-road glance duration (sec)\")+theme_grey(16)+coord_flip()+scale_colour_manual(values=c(\"gold\",\"tomato1\",\"skyblue3\",\"darkgreen\"))\n\n```\n",
    "created" : 1460043766072.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2685553321",
    "id" : "28A4AB0A",
    "lastKnownWriteTime" : 1459885118,
    "path" : "~/Dropbox/Works/AgeLab/JB and Jon/R code/2016 03 25 distributions of off-road glances.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_markdown"
}